<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Proyecto</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard.min.css" rel="stylesheet"
    type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard_theme_dots.min.css" rel="stylesheet"
        type="text/css" />
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/jquery.smartWizard.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />
    <!-- layaout1 -->
    <link href="static/vendor/animate.css/animate.min.css" rel="stylesheet" />
    <link href="static/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link
      href="static/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />
    <link href="static/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="static/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />
    <link href="static/css/style.css" rel="stylesheet" />
    <!-- layaout2 -->
    <link
      href="../static/vendor/animate.css/animate.min.css"
      rel="stylesheet"
    />
    <link
      href="../static/vendor/boxicons/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="../static/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />
    <link href="../static/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link
      href="../static/vendor/swiper/swiper-bundle.min.css"
      rel="stylesheet"
    />
    <link href="../static/css/style.css" rel="stylesheet" />
    <!-- layaout3 -->
    <link
      href="../../static/vendor/animate.css/animate.min.css"
      rel="stylesheet"
    />
    <link
      href="../../static/vendor/boxicons/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="../../static/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />
    <link href="../../static/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link
      href="../../static/vendor/swiper/swiper-bundle.min.css"
      rel="stylesheet"
    />
    <link href="../../static/css/style.css" rel="stylesheet" />
  </head>
  <body>
    <header id="header" class="fixed-top d-flex align-items-center">
      <div class="container d-flex align-items-center">
        <nav id="navbar" class="navbar navbar-expand-lg">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
              {% if current_user.is_authenticated and (current_user.idrole == 1 or current_user.idrole == 4) %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('productos.galeria') }}">Productos</a></li>
              {% endif %}
              {% if current_user.is_authenticated and (current_user.idrole == 1 or current_user.idrole == 2) %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('productos.listaProductos') }}">Lista de Productos</a></li>
              {% endif %}
              {% if current_user.is_authenticated and (current_user.idrole == 1 or current_user.idrole == 2) %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('materiaPrima.galeriaMateriaPrima') }}">Materia Prima</a></li>
              {% endif %}
              {% if current_user.is_authenticated and (current_user.idrole == 1) %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('materiaPrima.proovedores') }}">Proveedores</a></li>
              {% endif %}
              {% if not current_user.is_authenticated %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.login') }}">Acceder</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.register') }}">Registro</a></li>
              {% endif %}
              {% if current_user.is_authenticated and (current_user.idrole == 1 or current_user.idrole == 2 or current_user.idrole == 4 or current_user.idrole == 3) %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('pedidos.verPedidos') }}">Mis Pedidos</a></li>
              {% endif %}
              {% if current_user.is_authenticated and (current_user.idrole == 1) %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('altaUsuarios.createUsers') }}">Alta de usuarios</a></li>
              {% endif %}
              {% if current_user.is_authenticated and (current_user.idrole == 1) %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('finanzas.getFinanzas') }}">Finanzas</a></li>
              {% endif %}
              {% if current_user.is_authenticated %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('main.contacto') }}">Contacto</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.logout') }}">Salir</a></li>
              {% endif %}
            </ul>
          </div>
        </nav>
      </div>
    </header>
    
    {% block content %} {% endblock %}
    <footer id="footer">
      <div class="footer-top">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-6">
              <div class="footer-info">
                <h3>Proyecto</h3>
                <p>
                  Granja eva 114<br />
                  Granjeno Plus (IVEEG)<br />
                  37570 León, Gto<br /><br />
                  <strong>Telefono:</strong>477 641 92 98<br />
                  <strong>Correo:</strong> angro1212@gmail.com<br />
                </p>
              </div>
            </div>
            <div class="col-lg-4 col-md-6 footer-links">
              <h4>Enlaces</h4>
              <ul>
                {% if current_user.is_authenticated%}
                <li>
                  <a href="{{ url_for('productos.galeria') }}">Productos</a>
                </li>
                {% endif %} {% if current_user.is_authenticated and
                current_user.id == 1%}
                <li>
                  <a href="{{ url_for('productos.listaProductos') }}"
                    >Lista de Productos</a
                  >
                </li>
                {% endif %}
                <li><a href="{{ url_for('main.contacto') }}">Contacto</a></li>
                {% if not current_user.is_authenticated %}
                <li><a href="{{ url_for('auth.login') }}">Acceder</a></li>
                <li><a href="{{ url_for('auth.register') }}">Registro</a></li>
                {% endif %} {% if current_user.is_authenticated %}
                <li><a href="{{ url_for('auth.logout') }}">Salir</a></li>
                {% endif %}
              </ul>
            </div>
            <div class="col-lg-4 col-md-6 footer-links">
              <h4>Nuestras redes sociales</h4>
              <div class="social-links mt-3">
                <a href="#" class="twitter"><i class="bx bxl-twitter"></i></a>
                <a href="#" class="facebook"><i class="bx bxl-facebook"></i></a>
                <a href="#" class="instagram"
                  ><i class="bx bxl-instagram"></i
                ></a>
                <a href="#" class="google-plus"><i class="bx bxl-skype"></i></a>
                <a href="#" class="linkedin"><i class="bx bxl-linkedin"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="copyright">
          &copy; Copyright <strong><span>Proyecto</span></strong
          >. Todos los derechos reservados
        </div>
        <div class="credits"></div>
      </div>
    </footer>
    <a
      href="#"
      class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.5.0/annyang.min.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.js"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>

    <script>
      // Función para construir la tabla HTML con los detalles de los productos en el carrito
      function construirTablaCarrito() {
        var tabla = "<table class='table'>";
        tabla +=
          "<thead><tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Acciones</th></tr></thead>";
        tabla += "<tbody>";

        for (var idProducto in carrito) {
          var producto = carrito[idProducto];
          tabla += "<tr class='producto-row'>";
          tabla += "<td>" + producto.nombre + "</td>";
          tabla +=
            "<td class='costo' data-precio='" +
            producto.precio.toFixed(2) +
            "'>$" +
            producto.precio.toFixed(2) +
            "</td>";
          tabla +=
            "<td><input type='number' class='cantidad' min='1' max='1000' oninput='this.value=this.value.replace(/[^0-9]/g,\"\")' value='" +
            producto.cantidad +
            "'></input></td>";
          tabla +=
            "<td><button class='btn btn-danger' value='" +
            idProducto +
            "'>Eliminar</button></td>";
          tabla += "</tr>";
        }

        tabla += "</tbody></table>";

        return tabla;
      }
      // Función para reiniciar el carrito
      function reiniciarCarrito() {
        carrito = {};
        numProductos = 0;
        $("#numProductos").text(numProductos);
      }
      var carrito = {}; // Inicializamos el objeto que representa nuestro carrito de compras
      var numProductos = 0; // Inicializamos el número de productos en el carrito a cero

      // Función para actualizar la tabla del carrito
      function actualizarTablaCarrito() {
        var tabla = construirTablaCarrito();
        $("#tablaCarrito").html(tabla);
      }

      // Función para eliminar un producto del carrito
      function eliminarProductoCarrito(idProducto) {
        delete carrito[idProducto];
        var tabla = construirTablaCarrito();
        $("#carritoBody").html(tabla);
        actualizarSubtotal();
      }

      function calcularSubtotal() {
        var subtotal = 0;
        $("#carritoBody tr").each(function () {
          var cantidad = parseInt($(this).find(".cantidad").val());
          var costo = parseFloat($(this).find(".costo").data("precio"));
          if (!isNaN(cantidad) && !isNaN(costo)) {
            var productoSubtotal = cantidad * costo;
            subtotal += productoSubtotal;
          }
        });
        if (subtotal == 0){
          $("#btnPago").hide();
        }else{
          $("#btnPago").show();
        }
        return subtotal;
      }
      function calcularBotiquines() {
        var cantidadTotal = 0;
        $("#carritoBody tr").each(function () {
          var cantidad = parseInt($(this).find(".cantidad").val());
          if (!isNaN(cantidad)) {
            var botiquinesTotal = cantidad;
            cantidadTotal += botiquinesTotal;
          }
        });
        return cantidadTotal;
      }

      // Función para actualizar el valor del input subtotal en tiempo real
      function actualizarSubtotal() {
        var subtotal = calcularSubtotal();
        var cantidad = calcularBotiquines();
        $("#cantidadBotiquines").val(cantidad);
        $("#subtotal").val(subtotal.toFixed(2));
      }
      // Función para agregar eventos al modal
      function agregarEventosModalCarrito() {
        // Actualizar el subtotal cada vez que se muestre el modal
        $("#modalCarrito").on("show.bs.modal", function () {
          var tabla = construirTablaCarrito();
          $("#carritoBody").html(tabla);
          actualizarSubtotal();
        });
        // Actualizar el subtotal cada vez que se oculte el modal
        $("#modalCarrito").on("hidden.bs.modal", function () {
          actualizarSubtotal();
        });
        // Actualizar el subtotal cada vez que se cambie la cantidad de un producto
        $(document).on(
          "change",
          "#tablaCarrito input[type='number']",
          function () {
            actualizarSubtotal();
          }
        );
      }
      function validarTarjeta(numeroTarjeta) {
        // Convertir el número de tarjeta en una matriz de dígitos individuales
        var digitos = numeroTarjeta.toString().split("").map(Number);
        // Invertir la matriz de dígitos
        digitos.reverse();
        // Aplicar el algoritmo de Luhn
        var suma = digitos.reduce(function (acumulador, valorActual, indice) {
          if (indice % 2 === 1) {
            valorActual *= 2;
            if (valorActual > 9) {
              valorActual -= 9;
            }
          }
          return acumulador + valorActual;
        }, 0);
        // Comprobar si la suma total es divisible por 10
        return suma % 10 === 0;
      }
      function validarFechaVencimiento(mes, anio) {
        // Obtener la fecha actual
        var fechaActual = new Date();
        var anioActual = parseInt(
          fechaActual.getFullYear().toString().substring(2)
        );
        var mesActual = fechaActual.getMonth() + 1; // Los meses van de 0 a 11, sumamos 1 para obtener el mes actual real

        // Verificar si el año es válido
        if (anio < anioActual || anio > anioActual + 7) {
          return false;
        }

        // Verificar si el mes es válido
        if (mes < 1 || mes > 12) {
          return false;
        }

        // Si el año es igual al año actual, verificar si el mes ha expirado
        if (anio === anioActual && mes < mesActual) {
          return false;
        }

        // La fecha es válida y no ha expirado
        return true;
      }

      function validarFormulario() {
        var numeroTarjeta = $("#input-numero-tarjeta").val();
        var mes = $("#input-fecha-vencimiento-mes").val();
        var anio =$("#input-fecha-vencimiento-anio").val();
        var cvv = $("#input-CVV").val();        
        var mensajeError = "";
        var validado = true;
        var validarCC = true;
        if (numeroTarjeta == ''){
          validarCC = false;
          mensajeError += "Ingresa datos faltantes.";
          $("#input-numero-tarjeta").css("border-color", "red");
        }
        if (mes == ''){
          validarCC = false;
          mensajeError += "Ingresa datos faltantes.";
          $("#input-fecha-vencimiento-mes").css("border-color", "red");
        }
        if (anio == ''){
          validarCC = false;
          mensajeError += "Ingresa datos faltantes.";
          $("#input-fecha-vencimiento-anio").css("border-color", "red");
        }
        if (cvv == ''){
          validarCC = false;
          mensajeError += "Ingresa datos faltantes.";
          $("#input-CVV").css("border-color", "red");
        }
        if(validarCC == true){
          if (!validarTarjeta(numeroTarjeta)) {
            mensajeError += "El número de tarjeta no es válido. ";
            validado = false;
            $("#input-numero-tarjeta").css("border-color", "red");
          } else {
            $("#input-numero-tarjeta").css("border-color", "green");
          }

          if (!validarFechaVencimiento(mes, anio)) {
            mensajeError += "La fecha de vencimiento no es válida. ";
            validado = false;

            $("#input-fecha-vencimiento-mes").css("border-color", "red");
            $("#input-fecha-vencimiento-anio").css("border-color", "red");
          } else {
            $("#input-fecha-vencimiento-mes").css("border-color", "green");
            $("#input-fecha-vencimiento-anio").css("border-color", "green");
          }
          if (cvv.length !== 3 || isNaN(cvv)) {
            mensajeError += "Ingresa un CVV válido. ";
            validado = false;
            $("#input-CVV").css("border-color", "red");
          } else {
            $("#input-CVV").css("border-color", "green");
          }
          if (validado == true) {
            $("#input-fecha-vencimiento-mes").prop("readonly", true);
            $("#input-fecha-vencimiento-anio").prop("readonly", true);
            $("#input-numero-tarjeta").prop("readonly", true);
            $("#input-CVV").prop("readonly", true);
          } 
      }
      $("#mensaje-errorCC").text(mensajeError);

        return validado;
      }

      //-------------------------------------------------------------------------------------------------------------------------------------
      //------------------------------------------------------------inicio document ready----------------------------------------------------
      //-------------------------------------------------------------------------------------------------------------------------------------
      $(document).ready(function () {
        $("#btnActualizarProovedores").hide();
        $("#btnComprarProducto").hide();
        $(".pago").hide();
        $(".cantidad").hide();
        $("#comprarH2").hide();
        $(".usuarios").hide();
        $("#altadeusuariosCerrar").hide();
        
        $('#smartwizard').smartWizard({
          selected: 0,
          theme: 'dots',
          autoAdjustHeight:true,
          transitionEffect:'fade',
          showStepURLhash: false,
         });
         

        let table = new DataTable("#myTable", {
          searching: true,
          paging: true,
          ordering: true,
          language: {
            url: "//cdn.datatables.net/plug-ins/1.10.25/i18n/Spanish.json",
          },
        });

        $('#cerrar-modal').on('click', function() {
          location.reload();
        });
//terminar

        //---------------------------------------------jquery carrito----------------------------------------------------
        agregarEventosModalCarrito();
        $("#ventanaCarrito").on("click", function () {
          actualizarSubtotal();
          $("#modalCarrito").modal();
        });
        
        

        $(document).on(
          "change",
          "#tablaCarrito input[type='number']",
          function () {
            var idProducto = $(this).closest("tr").data("id");
            var nuevaCantidad = parseInt($(this).val());

            if (carrito[idProducto]) {
              carrito[idProducto].cantidad = nuevaCantidad;
              actualizarTablaCarrito();
            }
          }
        );
        // Función que se llama cuando se hace clic en el botón "Agregar al carrito"
        $(".agregar-carrito").click(function () {
          var idProducto = $(this).val(); // Obtenemos el ID del producto que se está agregando
          console.log(idProducto);
          var nombre = $(this)
            .closest(".card")
            .find(".card-title")
            .text(); // Obtenemos el nombre del producto
            console.log(nombre);
          var precio = $(this)
            .closest(".card")
            .find(".card-text")
            .text(); // Obtenemos el precio del producto
            console.log(precio);
          precio = parseFloat(precio.replace("$", "")); // Convertimos el precio a un número

          // Si el producto ya está en el carrito, incrementamos la cantidad en 1. Si no, lo agregamos al carrito.

          carrito[idProducto] = {
            nombre: nombre,
            precio: precio,
            cantidad: 1,
          };

          numProductos++; // Incrementamos el número de productos en el carrito

          // Actualizamos el número que se muestra en el botón "Carrito"
          $("#numProductos").text(numProductos);
        });

        // Actualizamos el contenido del modal cada vez que se muestra
        $("#modalCarrito").on("show.bs.modal", function () {
          var tabla = construirTablaCarrito();
          var tabla2 = actualizarSubtotal();
          $("#carritoBody").html(tabla, tabla2);
        });
        // Asignar evento de clic para los botones de eliminar
        $(document).on("click", ".btn-danger", function (event) {
          var idProducto = $(this).val();
          eliminarProductoCarrito(idProducto);
        });

        // Función que se llama cuando se hace clic en el botón "Comprar"
        $("#modalCarrito .btn-success").click(function () {
          reiniciarCarrito();
          $("#tablaCarrito").html("<p>Tu carrito está vacío.</p>");
        });

        // Función que se llama cuando se hace clic en el botón "Comprar"
        $("#modalCarrito .btn-success").click(function () {
          reiniciarCarrito();
          $("#tablaCarrito").html("<p>Tu carrito está vacío.</p>");
        });
        //subtotal
        $(document).on("change", ".table", function () {
          actualizarSubtotal();
        });

        // VALIDAR PAGO
        $("#btnPago").click(function () {
          $("#modalCarrito").modal("hide");
          var botiquinesXhacer = $("#cantidadBotiquines").val();
          $.ajax({
            type: 'POST',
            url: '/pedidos/obtener_domicilio',
            success: function(response) {
              //horas de espera
              var botiquines = response.totalBotiquines;
              //horas con el pedido
              var horasEspera = parseFloat(botiquinesXhacer) + parseFloat(botiquines);
              //dias de espera
              var diasEspera = Math.ceil(horasEspera / 8)+1;
              $("#tiempodeentrega").text(diasEspera);
              $("#estado").val(response.estado);
              $("#municipio").val(response.municipio);
              $("#codigoPostal").val(response.codigoPostal);
              $("#colonia").val(response.colonia);
              $("#calle").val(response.calle);
              $("#numeroInt").val(response.numeroInt);
              $("#numeroExt").val(response.numeroExt);
              $("#referencia").val(response.referencia);
            }
          });
        });

        $("#validarDatos").click(function (event) {
          var estado = $("#estado").val().trim();
          var municipio = $("#municipio").val().trim();
          var cp = $("#codigoPostal").val().trim();
          var colonia = $("#colonia").val().trim();
          var calle = $("#calle").val().trim();
          var numeroInt = $("#numeroInt").val().trim();
          var numeroExt = $("#numeroExt").val().trim();
          var ref = $("#referencia").val().trim();
          var numeroTarjeta = $("#input-numero-tarjeta").val();
          var mes = $("#input-fecha-vencimiento-mes").val();
          var anio = $("#input-fecha-vencimiento-anio").val();
          var cvv = $("#input-CVV").val();
          var mensajeErrorCC = "";
          var mensajeError = "";
          var validarDatos = true;
          var validarCC = true;

          if (estado == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            $("#estado").css("border-color", "red");
          } else {
            $("#estado").css("border-color", "green");
          }
          
          if (municipio == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            $("#municipio").css("border-color", "red");
          } else {
            $("#municipio").css("border-color", "green");
          }
          
          if (cp == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            $("#codigoPostal").css("border-color", "red");
          } else {
            $("#codigoPostal").css("border-color", "green");
          }
          
          if (colonia == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            $("#colonia").css("border-color", "red");
          } else {
            $("#colonia").css("border-color", "green");
          }
          
          if (calle == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            $("#calle").css("border-color", "red");
          } else {
            $("#calle").css("border-color", "green");
          }
          
          if (numeroExt == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            $("#numeroExt").css("border-color", "red");
          } else {
            $("#numeroExt").css("border-color", "green");
          }
          
          if (ref == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            $("#referencia").css("border-color", "red");
          } else {
            $("#referencia").css("border-color", "green");
          }
          
          if (numeroTarjeta == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            validarCC = false;
            $("#input-numero-tarjeta").css("border-color", "red");
          } else {
            $("#input-numero-tarjeta").css("border-color", "green");
          }
          
          if (mes == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            validarCC = false;
            $("#input-fecha-vencimiento-mes").css("border-color", "red");
          } else {
            $("#input-fecha-vencimiento-mes").css("border-color", "green");
          }
          
          if (anio == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            validarCC = false;
            $("#input-fecha-vencimiento-anio").css("border-color", "red");
          } else {
            $("#input-fecha-vencimiento-anio").css("border-color", "green");
          }
          
          if (cvv == '') {
            mensajeError = "";
            mensajeError += "Ingresa Datos Faltantes";
            validarDatos = false;
            validarCC = false;
            $("#input-CVV").css("border-color", "red");
          } else {
            $("#input-CVV").css("border-color", "green");
          }
          
          $("#mensaje-error").text(mensajeError);
          if (validarCC == true) {
            
            if (!validarTarjeta(numeroTarjeta)) {
              mensajeErrorCC += "El número de tarjeta no es válido. <br>";
              validarDatos = false;
              $("#input-numero-tarjeta").css("border-color", "red");
            } else {
              $("#input-numero-tarjeta").css("border-color", "green");
            }

            if (!validarFechaVencimiento(mes, anio)) {
              mensajeErrorCC += "La fecha de vencimiento no es válida. <br>";
              validarDatos = false;

              $("#input-fecha-vencimiento-mes").css("border-color", "red");
              $("#input-fecha-vencimiento-anio").css("border-color", "red");
            } else {
              $("#input-fecha-vencimiento-mes").css("border-color", "green");
              $("#input-fecha-vencimiento-anio").css("border-color", "green");
            }
            if (cvv.length !== 3 || isNaN(cvv)) {
              mensajeErrorCC += "Ingresa un CVV válido. <br>";
              validarDatos = false;
              $("#input-CVV").css("border-color", "red");
            } else {
              $("#input-CVV").css("border-color", "green");
            }
            document.getElementById("mensaje-errorCC").innerHTML = mensajeErrorCC;
          }
        if (validarDatos == true){
          $("#validarH1").hide();
          $("#comprarH2").show();
          $("#input-fecha-vencimiento-mes").prop("readonly", true);
          $("#input-fecha-vencimiento-anio").prop("readonly", true);
          $("#input-numero-tarjeta").prop("readonly", true);
          $("#input-CVV").prop("readonly", true);
          $("#estado").prop("readonly", true);
          $("#municipio").prop("readonly", true);
          $("#codigoPostal").prop("readonly", true);
          $("#colonia").prop("readonly", true);
          $("#calle").prop("readonly", true);
          $("#numeroInt").prop("readonly", true);
          $("#numeroExt").prop("readonly", true);
          $("#referencia").prop("readonly", true);
        }


        });

        var productos = [];
        $("#comprarBtn").click(function (event) {
          // Evitar que la página se recargue
          event.preventDefault();
          var productos = [];
          var estado = $("#estado").val();
          var municipio = $("#municipio").val();
          var cp = $("#codigoPostal").val();
          var colonia = $("#colonia").val();
          var calle = $("#calle").val();
          var numeroInt = $("#numeroInt").val();
          var numeroExt = $("#numeroExt").val();
          var ref = $("#referencia").val();
          var botiquines = $("#cantidadBotiquines").val();
          Swal.fire({
            title: "Realizar pedido?",
            text: "Al aceptar vas a generar tu pedido",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Si, realizar compra!",
          }).then((result) => {
            if (result.isConfirmed) {
              $(".producto-row").each(function (event) {
                var id = $(this).find(".btn-danger").val();
                var cantidad = $(this).find(".cantidad").val();
                var precio = $(this).find(".costo").data("precio");
                var total = cantidad * precio;
                productos.push({
                  id: id,
                  cantidad: cantidad,
                  precio: precio,
                  total: total,
                });
              });
              // Obtener el subtotal
              var subtotal = productos.reduce(function (total, producto) {
                return total + producto.total;
              }, 0);
              // Convertir los datos a una cadena JSON
              var data = JSON.stringify({
                productos: productos,
                subtotal: subtotal,
                estado : estado ,
                municipio : municipio , 
                codigoPostal :cp  ,
                colonia : colonia ,
                calle : calle ,
                numeroExt : numeroExt ,
                numeroInt : numeroInt ,
                referencia : ref,
                totalBotiquines: botiquines
              });
              // Enviar la solicitud AJAX
              $.ajax({
                type: "POST",
                url: "/pedidos/crear_pedido",
                data: data,
                contentType: "application/json;charset=UTF-8",
                success: function (response) {
                  // Manejar la respuesta del servidor
                  Swal.fire({
                    icon: "success",
                    title: "Pedido realizado",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                    else {
                      location.reload();
                    }
                  });
                },
                error: function (error) {
                  // Manejar el error
                  Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Algo salió mal!",
                  });
                },
              });
            }
          });
        });
        //-----------------------------------------cancelar pedido---------------------------------------------------
        $(".btnCancelarPedido").click(function () {
          var idCompra = $(this).val();
          var data = JSON.stringify({
            idCompra: idCompra,
          });
          Swal.fire({
            title: "Cancelar pedido?",
            text: "Al aceptar vas a cancelar tu pedido",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Si, cancelar compra!",
          }).then((result) => {
            $.ajax({
              type: "POST",
              url: "/pedidos/cancelar_pedido",
              data: data,
              contentType: "application/json;charset=UTF-8",
              success: function (response) {
                // Manejar la respuesta del servidor
                Swal.fire({
                  icon: "success",
                  title: "Compra cancelada",
                  showConfirmButton: true,
                }).then((result) => {
                  if (result.isConfirmed) {
                    location.reload();
                  }
                });
              },
              error: function (error) {
                // Manejar el error
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Algo salió mal!",
                });
              },
            });
          });
        });
        //-----------------------------------------fin cancelar pedido---------------------------------------------------

        //-----------------------------------------Inicio Cambiar Estatus---------------------------------------------------

        $(".btnEnviar").click(function () {
          var IDcompra = $(this).val();
          var data = JSON.stringify({
            idCompra: IDcompra,
          });

          Swal.fire({
            title: "Enviar Pedido?",
            text: "Al aceptar vas a enviar el pedido",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Si, enviar el pedido!",
          }).then((result) => {
            $.ajax({
              type: "POST",
              url: "/pedidos/enviarPedido",
              data: data,
              contentType: "application/json;charset=UTF-8",
              success: function (response) {
                console.log(response);
                // Manejar la respuesta del servidor
                Swal.fire({
                  icon: "success",
                  title: "Pedido Enviado",
                  showConfirmButton: true,
                }).then((result) => {
                  if (result.isConfirmed) {
                    location.reload();
                  }
                });
              },
              error: function (error) {
                // Manejar el error
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Algo salió mal!",
                });
              },
            });
          });
        });

        $(".btnEntregar").click(function () {
          var IDcompra = $(this).val();
          var data = JSON.stringify({
            idCompra: IDcompra,
          });

          Swal.fire({
            title: "Entregar Pedido?",
            text: "Al aceptar vas a marcar como entregado",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Si!",
          }).then((result) => {
            $.ajax({
              type: "POST",
              url: "/pedidos/entregarPedido",
              data: data,
              contentType: "application/json;charset=UTF-8",
              success: function (response) {
                console.log(response);
                // Manejar la respuesta del servidor
                Swal.fire({
                  icon: "success",
                  title: "Pedido Entregado",
                  showConfirmButton: true,
                }).then((result) => {
                  if (result.isConfirmed) {
                    location.reload();
                  }
                });
              },
              error: function (error) {
                // Manejar el error
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Algo salió mal!",
                });
              },
            });
          });
        });

        $(".btnAceptar").click(function () {
          var IDcompra = $(this).val();
          var data = JSON.stringify({
            idCompra: IDcompra,
          });
          Swal.fire({
            title: "Aceptar Pedido?",
            text: "Al aceptar el pedido se descontará la materia prima",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Si, aceptar!",
          }).then((result) => {
            $.ajax({
              type: "POST",
              url: "/pedidos/actualizar_compra",
              data: data,
              contentType: "application/json;charset=UTF-8",
              success: function (response) {
                // Manejar la respuesta del servidor
                console.log(response.message);
                if (response.status == 'succes'){
                Swal.fire({
                  icon: "success",
                  title: "Pedido Aceptado",
                  showConfirmButton: true,
                }).then((result) => {
                  if (result.isConfirmed) {
                    location.reload();
                  }
                });
                }
                if (response.message == 'No hay suficiente tela para completar la compra'){
                  Swal.fire({
                    icon: "error",
                    title: "No hay suficiente tela para aceptar el pedido",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                  });
                } else if (response.message == 'No hay suficiente hilo para completar la compra'){
                  Swal.fire({
                    icon: "error",
                    title: "No hay suficiente hilo para aceptar el pedido",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                  });
                } else if (response.message == 'No hay suficiente cierre para completar la compra'){
                  Swal.fire({
                    icon: "error",
                    title: "No hay suficiente cierre para aceptar el pedido",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                  });
                } else if (response.message == 'No hay suficientes Carros para completar la compra'){
                  Swal.fire({
                    icon: "error",
                    title: "No hay suficientes Carros para aceptar el pedido",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                  });
                } else if (response.message == 'No hay suficientes Argollas para completar la compra'){
                  Swal.fire({
                    icon: "error",
                    title: "No hay suficientes Argollas para aceptar el pedido",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                  });
                } else if (response.message == 'No hay suficiente Reflejante para completar la compra'){
                  Swal.fire({
                    icon: "error",
                    title: "No hay suficiente Reflejante para aceptar el pedido",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                  });
                } else if (response.message == 'No hay suficiente Bandola para completar la compra'){
                  Swal.fire({
                    icon: "error",
                    title: "No hay suficiente Bandola para aceptar el pedido",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                  });
                } else if (response.message == 'No hay suficientes Hombreras para completar la compra'){
                  Swal.fire({
                    icon: "error",
                    title: "No hay suficientes Hombreras para aceptar el pedido",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                  });
                }
                
              },
              error: function (error) {
                // Manejar el error
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Algo salió mal!",
                });
              },
            });
          });
        });

        //-----------------------------------------fin Cambiar Estatus---------------------------------------------------

        //-----------------------------------------Inicio Proovedores---------------------------------------------------

        //GUARDAR PROOVEDORES

        $("#btnGuardarProovedores").click(function(){
          var nombreProovedor = $("#proveedor").val();
          var CostoXMetro = $("#costxmetro").val();
          var MateriaPrima = $("#materiaPrima").val();
          var mensajeError = "";
          var validado = true;
          var data = JSON.stringify({
            nombre: nombreProovedor,
            costoxmetro: CostoXMetro,
            materiaPrima: MateriaPrima,
          });
          if (nombreProovedor == ''){
            validado = false;
            mensajeError += "Ingresa nombre proovedor\n";
            $("#proveedor").css("border-color", "red");
          }
          if (CostoXMetro == '' || CostoXMetro == 0){
            validado = false;
            mensajeError += "Ingresa el costo por metro\n";
            $("#costxmetro").css("border-color", "red");
          }
          if (MateriaPrima == ''){
            validado = false;
            mensajeError += "Selecciona la materia prima\n";
            $("#materiaPrima").css("border-color", "red");
          }
          $("#mensaje-error").text(mensajeError);
          if (validado == true) {
            $("#materiaPrima").css("border-color", "green");
            $("#costxmetro").css("border-color", "green");
            $("#proveedor").css("border-color", "green");
            Swal.fire({
              title: "Guardar Proveedor?",
              text: "Estás seguro que deseas guardar el proveedor?",
              icon: "question",
              showCancelButton: true,
              confirmButtonColor: "#3085d6",
              cancelButtonColor: "#d33",
              confirmButtonText: "Si, guardar!"
            }).then((result) => {
              if (result.isConfirmed) {
                $.ajax({
                  type: "POST",
                  url: "/materiaPrima/guardar_proovedor",
                  data: data,
                  contentType: "application/json;charset=UTF-8",
                  success: function (response) {
                    // Manejar la respuesta del servidor
                    Swal.fire({
                      icon: "success",
                      title: "Proveedor guardado!",
                      showConfirmButton: true,
                    }).then((result) => {
                      if (result.isConfirmed) {
                        location.reload();
                      }
                    });
                  },
                  error: function (error) {
                    // Manejar el error
                    Swal.fire({
                      icon: "error",
                      title: "Oops...",
                      text: "Algo salió mal!",
                    });
                  },
                });
              }
            });
          } 
        })

        //ACTUALIZAR PROOVEDORES
        var idProovedor = ""
        $(".btnActualizar").click(function(){
          idProovedor = ""
          var id = $(this).val();
          idProovedor += id
          $("#btnComprarProducto").hide();
          $(".pago").hide();
          $(".cantidad").hide();
          $("#btnGuardarProovedores").hide();
          $("#btnActualizarProovedores").show();
          var data = JSON.stringify({
            proovedoresId: id
          });
          
          $.ajax({
            url: "/materiaPrima/actualizar_proveedor",
            data: data,
            type: "POST",
            contentType: "application/json;charset=UTF-8",
            success: function(data){
              $("#proveedor").val(data.nombre).prop("readonly", false);
              $("#costxmetro").val(data.costoxmetro).prop("readonly", false);
              $("#materiaPrima").val(data.materiaPrima);
              $("#materiaPrima").prop("disabled", false).selectpicker('refresh');

            }
          });
        });

        $("#btnActualizarProovedores").click(function(){
          var id = idProovedor
          var nombreProovedor = $("#proveedor").val();
          var CostoXMetro = $("#costxmetro").val();
          var MateriaPrima = $("#materiaPrima").val();
          var mensajeError = "";
          var validado = true;
          var data = JSON.stringify({
            nombre: nombreProovedor,
            costoxmetro: CostoXMetro,
            materiaPrima: MateriaPrima,
            proovedoresId: id
          });
          if (nombreProovedor == ''){
            validado = false;
            mensajeError += "Ingresa nombre proovedor\n";
            $("#proveedor").css("border-color", "red");
          }
          if (CostoXMetro == '' || CostoXMetro == 0){
            validado = false;
            mensajeError += "Ingresa el costo por metro\n";
            $("#costxmetro").css("border-color", "red");
          }
          if (MateriaPrima == ''){
            validado = false;
            mensajeError += "Selecciona la materia prima\n";
            $("#materiaPrima").css("border-color", "red");
          }
          $("#mensaje-error").text(mensajeError);
          if (validado == true) {
            $("#materiaPrima").css("border-color", "green");
            $("#costxmetro").css("border-color", "green");
            $("#proveedor").css("border-color", "green");
            Swal.fire({
              title: "Guardar Proveedor?",
              text: "Estás seguro que deseas actualizar el proveedor?",
              icon: "question",
              showCancelButton: true,
              confirmButtonColor: "#3085d6",
              cancelButtonColor: "#d33",
              confirmButtonText: "Si, guardar!"
            }).then((result) => {
              if (result.isConfirmed) {
                $.ajax({
                  type: "POST",
                  url: "/materiaPrima/editar_proovedor",
                  data: data,
                  contentType: "application/json;charset=UTF-8",
                  success: function (response) {
                    // Manejar la respuesta del servidor
                    Swal.fire({
                      icon: "success",
                      title: "Proveedor Actualizado!",
                      showConfirmButton: true,
                    }).then((result) => {
                      if (result.isConfirmed) {
                        location.reload();
                      }
                    });
                  },
                  error: function (error) {
                    // Manejar el error
                    Swal.fire({
                      icon: "error",
                      title: "Oops...",
                      text: "Algo salió mal!",
                    });
                  },
                });
              }
            });
          } 
        })

        //COMPRAR PRODUCTO
        $(".btnComprar").click(function(){
          idProovedor = ''
          var id = $(this).val();
          idProovedor += id
          $("#btnGuardarProovedores").hide();
          $("#btnActualizarProovedores").hide();
          $("#btnComprarProducto").show();
          $(".pago").show();
          $(".cantidad").show();
          var data = JSON.stringify({
            proovedoresId: id
          });
          
          $.ajax({
            url: "/materiaPrima/actualizar_proveedor",
            data: data,
            type: "POST",
            contentType: "application/json;charset=UTF-8",
            success: function(data){
              $("#costxmetro").val(data.costoxmetro).prop("readonly", true);
              $("#materiaPrima").val(data.materiaPrima);
              $("#proveedor").val(data.nombre);
              $("#materiaPrima").prop("disabled", true);
              $("#proveedor").prop("disabled", true);
              $("#materiaPrima").selectpicker('refresh');
              $("#proveedor").selectpicker('refresh');
            }
          });
        });

        $("#cantidad").change(function() {
           var cantidadMetros = $("#cantidad").val();
           var CostoXMetro = $("#costxmetro").val();

           var preciototal = cantidadMetros * CostoXMetro;
           $("#pagoTotal").val(preciototal);
        });


        $("#btnComprarProducto").click(function(){

          var id = idProovedor
          var MateriaPrima = $("#materiaPrima").val();
          var cantidadMetros = $("#cantidad").val();
          var pagoTotal = $("#pagoTotal").val();

          var mensajeError = "";
          var validado = true;

          var data = JSON.stringify({
            cantidadEnMetros: cantidadMetros,
            pagoTotal: pagoTotal,
            proovedoresId: id,
            nombreMateriaPrima: MateriaPrima
          });
          if (cantidadMetros == '' || cantidadMetros < 50 || cantidadMetros > 5000){
            validado = false;
            mensajeError += "Ingresa cantidad en metros, deben ser minimo 50 y maximo 1000 metros\n";
            $("#cantidad").css("border-color", "red");
          }
          if (pagoTotal == '' ){
            validado = false;
            mensajeError += "Ingresa el Pago Total\n";
            $("#pagoTotal").css("border-color", "red");
          }
          
          $("#mensaje-error").text(mensajeError);
          if (validado == true) {
            $("#materiaPrima").css("border-color", "green");
            $("#costxmetro").css("border-color", "green");
            $("#proveedor").css("border-color", "green");
            $("#cantidad").css("border-color", "green");
            $("#pagoTotal").css("border-color", "green");
            Swal.fire({
              title: "Realizar Compra?",
              text: "Estás seguro que deseas realizar la compra?",
              icon: "question",
              showCancelButton: true,
              confirmButtonColor: "#3085d6",
              cancelButtonColor: "#d33",
              confirmButtonText: "Si, comprar!"
            }).then((result) => {
              if (result.isConfirmed) {
                $.ajax({
                  type: "POST",
                  url: "/materiaPrima/comprar_materiaPrima",
                  data: data,
                  contentType: "application/json;charset=UTF-8",
                  success: function (response) {
                    // Manejar la respuesta del servidor
                    Swal.fire({
                      icon: "success",
                      title: "Compra Realizada!",
                      showConfirmButton: true,
                    }).then((result) => {
                      if (result.isConfirmed) {
                        location.reload();
                      }
                      else {
                        location.reload();
                      }
                    });
                  },
                  error: function (error) {
                    // Manejar el error
                    Swal.fire({
                      icon: "error",
                      title: "Oops...",
                      text: "Algo salió mal!",
                    });
                  },
                });
              }
            });
          } 
          
        });

        //ELIMINAR PROOVEDOR

        $(".btnEliminar").click(function(){
          var id = $(this).val();
          var data = JSON.stringify({
            proovedoresId: id,
          });
          Swal.fire({
            title: "Realizar Compra?",
            text: "Estás seguro que deseas eliminar al proovedor?",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Si, eliminar!"
          }).then((result) => {
            if (result.isConfirmed) {
              $.ajax({
                type: "POST",
                url: "/materiaPrima/eliminar_proovedor",
                data: data,
                contentType: "application/json;charset=UTF-8",
                success: function (response) {
                  // Manejar la respuesta del servidor
                  Swal.fire({
                    icon: "success",
                    title: "Proovedor Eliminado!",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                    else {
                      location.reload();
                    }
                  });
                },
                error: function (error) {
                  // Manejar el error
                  Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Algo salió mal!",
                  });
                },
              });
            }
          });
        })


        //-----------------------------------------fin Proovedores---------------------------------------------------


        //-----------------------------------------Inicio Registro---------------------------------------------------
        
        $("#btnRegistrar").click(function(){
          event.preventDefault();
          var correo = $("#email").val().trim();
          var nombre = $("#nombre").val().trim();
          var contraseña = $("#password").val().trim();
          var estado = $("#estado").val().trim();
          var municipio = $("#municipio").val().trim();
          var cp = $("#codigoPostal").val().trim();
          var colonia = $("#colonia").val().trim();
          var calle = $("#calle").val().trim();
          var numeroInt = $("#numeroInt").val().trim();
          var numeroExt = $("#numeroExt").val().trim();
          var ref = $("#referencia").val().trim();
          var mensajeError = "Ingresa datos faltantes";
          var validado = true;

          var data = JSON.stringify({
            email: correo,
            name: nombre,
            password: contraseña,
            estado:estado,
            municipio:municipio,
            codigoPostal:cp,
            colonia:colonia,
            calle:calle,
            numeroInt:numeroInt,
            numeroExt:numeroExt,
            referencia:ref
          });


          // Verifica que los campos requeridos no estén vacíos o llenos de espacios
          if (correo == ''){
            validado = false;
            $("#email").css("border-color", "red");
          }
          if (nombre == ''){
            validado = false;
            $("#nombre").css("border-color", "red");
          }
          if (contraseña == ''){
            validado = false;
            $("#password").css("border-color", "red");
          }
          if (estado == ''){
            validado = false;
            $("#estado").css("border-color", "red");
          }
          if (municipio == ''){
            validado = false;
            $("#municipio").css("border-color", "red");
          }
          if (cp == ''){
            validado = false;
          
            $("#codigoPostal").css("border-color", "red");
          }
          if (colonia == ''){
            validado = false;
            $("#colonia").css("border-color", "red");
          }
          if (calle == ''){
            validado = false;
            $("#calle").css("border-color", "red");
          }
          if (numeroExt == ''){
            validado = false;
          
            $("#numeroExt").css("border-color", "red");
          }
          if (ref == ''){
              validado = false;
              $("#referencia").css("border-color", "red");
          }
          $("#mensaje-error").text(mensajeError);
          if (validado == true){
            $.ajax({
              type: "POST",
              url: "/security/registerU",
              data: data,
              contentType: "application/json;charset=UTF-8",
              success: function (response) {
                console.log(response.status);
                // Manejar la respuesta del servidor
              if (response.status == 'success'){
                Swal.fire({
                  icon: "success",
                  title: "Registro correcto!",
                  text: "Dirigete a la pestaña de inicio de sesión",
                  showConfirmButton: true,
                }).then((result) => {
                  if (result.isConfirmed) {
                    location.reload();
                  }
                  else {
                    location.reload();
                  }
                });
              }
              if (response.status == 'error'){
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "El correo ya está registrado, usa otro",
                });
              }
              },
              error: function (error) {
                // Manejar el error
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Algo salió mal!",
                });
              },
            });
          }

        });


        //-----------------------------------------fin Registro---------------------------------------------------

        //-----------------------------------------Inicio Alta de Usuarios-----------------------------------------
        $("#altadeusuariosAbrir").click(function(){
          $(".usuarios").show();
          $("#altadeusuariosAbrir").hide();
          $("#altadeusuariosCerrar").show();
          $("#btnUpdateUsuario").hide();
          $("#btnRegistrarUsuario").show();
        })
        
        $("#altadeusuariosCerrar").click(function(){
          $("#email").val('');
          $("#nombre").val('');
          $("#estado").val('');
          $("#municipio").val('');
          $("#codigoPostal").val('');
          $("#colonia").val('');
          $("#calle").val('');
          $("#numeroInt").val('');
          $("#numeroExt").val('');
          $("#referencia").val('');
          $(".usuarios").hide();
          $("#altadeusuariosAbrir").show();
          $("#altadeusuariosCerrar").hide();
          $("#btnUpdateUsuario").hide();
          $("#btnRegistrarUsuario").show();


        })

        $("#btnRegistrarUsuario").click(function(){
          event.preventDefault();
          var correo = $("#email").val().trim();
          var nombre = $("#nombre").val().trim();
          var contraseña = $("#password").val().trim();
          var estado = $("#estado").val().trim();
          var municipio = $("#municipio").val().trim();
          var cp = $("#codigoPostal").val().trim();
          var colonia = $("#colonia").val().trim();
          var calle = $("#calle").val().trim();
          var numeroInt = $("#numeroInt").val().trim();
          var numeroExt = $("#numeroExt").val().trim();
          var ref = $("#referencia").val().trim();
          var estatus = $("#idrole").val();
          var mensajeError = "Ingresa datos faltantes";
          var validado = true;

          var data = JSON.stringify({
            email: correo,
            name: nombre,
            password: contraseña,
            estado:estado,
            municipio:municipio,
            codigoPostal:cp,
            colonia:colonia,
            calle:calle,
            numeroInt:numeroInt,
            numeroExt:numeroExt,
            referencia:ref,
            estatus:estatus
          });


          // Verifica que los campos requeridos no estén vacíos o llenos de espacios
          if (correo == '' || !/(gmail|hotmail|outlook)\.com$/i.test(correo)) {
            validado = false;
            $("#email").css("border-color", "red");
            if (correo == '') {
              validado = false;
              $("#email").css("border-color", "red");
            } else {
              validado = false;
              mensajeError = '';
              mensajeError += 'Por favor ingrese una dirección de correo electrónico válida de Gmail, Hotmail u Outlook.'
            }
          }
          
          if (nombre == ''){
            validado = false;
            $("#nombre").css("border-color", "red");
          }
          if (contraseña == ''){
            validado = false;
            $("#password").css("border-color", "red");
          }
          if (estado == ''){
            validado = false;
            $("#estado").css("border-color", "red");
          }
          if (municipio == ''){
            validado = false;
            $("#municipio").css("border-color", "red");
          }
          if (cp == ''){
            validado = false;
          
            $("#codigoPostal").css("border-color", "red");
          }
          if (colonia == ''){
            validado = false;
            $("#colonia").css("border-color", "red");
          }
          if (calle == ''){
            validado = false;
            $("#calle").css("border-color", "red");
          }
          if (numeroExt == ''){
            validado = false;
          
            $("#numeroExt").css("border-color", "red");
          }
          if (ref == ''){
              validado = false;
              $("#referencia").css("border-color", "red");
          }
          $("#mensaje-error").text(mensajeError);
          if (validado == true){
            $.ajax({
              type: "POST",
              url: "/altaUsuarios/registerUsuario",
              data: data,
              contentType: "application/json;charset=UTF-8",
              success: function (response) {
                console.log(response.status);
                // Manejar la respuesta del servidor
              if (response.status == 'success'){
                Swal.fire({
                  icon: "success",
                  title: "Registro correcto!",
                  text: "Nuevo usuario registrado",
                  showConfirmButton: true,
                }).then((result) => {
                  if (result.isConfirmed) {
                    location.reload();
                  }
                  else {
                    location.reload();
                  }
                });
              }
              if (response.status == 'error'){
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "El correo ya está registrado, usa otro",
                });
              }
              },
              error: function (error) {
                // Manejar el error
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Algo salió mal!",
                });
              },
            });
          }

        });

        //desactivar usuario
        $(".btnDesactivarUser").click(function(){
          var id = $(this).val();
          var data = JSON.stringify({
            id: id,
          });
          Swal.fire({
            title: "Desactivar Usuario?",
            text: "Estás seguro que deseas eliminar al usuario?",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Si, eliminar!"
          }).then((result) => {
            if (result.isConfirmed) {
              $.ajax({
                type: "POST",
                url: "/altaUsuarios/eliminar_user",
                data: data,
                contentType: "application/json;charset=UTF-8",
                success: function (response) {
                  // Manejar la respuesta del servidor
                  Swal.fire({
                    icon: "success",
                    title: "Usuario Eliminado!",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                    else {
                      location.reload();
                    }
                  });
                },
                error: function (error) {
                  // Manejar el error
                  Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Algo salió mal!",
                  });
                },
              });
            }
          });

        })

        //actualizar usuario
        var idUser = ""
        $(".btnActualizarUser").click(function(){
          $(".usuarios").show();
          $("#altadeusuariosAbrir").hide();
          $("#altadeusuariosCerrar").show();
          $("#btnUpdateUsuario").show();
          $("#btnRegistrarUsuario").hide();
          idUser = ""
          var id = $(this).val();
          idUser += id;
          var data = JSON.stringify({
            id: id,
          });
          
          $.ajax({
            url: "/altaUsuarios/actualizar_user",
            data: data,
            type: "POST",
            contentType: "application/json;charset=UTF-8",
            success: function(data){
              $("#email").val(data.email);
              $("#nombre").val(data.name);
              $("#estado").val(data.estado);
              $("#municipio").val(data.municipio);
              $("#codigoPostal").val(data.codigoPostal);
              $("#colonia").val(data.colonia);
              $("#calle").val(data.calle);
              $("#numeroInt").val(data.numeroInt);
              $("#numeroExt").val(data.numeroExt);
              $("#referencia").val(data.referencia);
            }
          });
        })



        //activar usuario
        $(".btnActivarUser").click(function(){
          var id = $(this).val();
          var data = JSON.stringify({
            id: id,
          });
          Swal.fire({
            title: "Activar Usuario?",
            text: "Estás seguro que deseas Activar al usuario?",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Si, Activar!"
          }).then((result) => {
            if (result.isConfirmed) {
              $.ajax({
                type: "POST",
                url: "/altaUsuarios/activar_user",
                data: data,
                contentType: "application/json;charset=UTF-8",
                success: function (response) {
                  // Manejar la respuesta del servidor
                  Swal.fire({
                    icon: "success",
                    title: "Usuario Activado!",
                    showConfirmButton: true,
                  }).then((result) => {
                    if (result.isConfirmed) {
                      location.reload();
                    }
                    else {
                      location.reload();
                    }
                  });
                },
                error: function (error) {
                  // Manejar el error
                  Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Algo salió mal!",
                  });
                },
              });
            }
          });
        })


        //UpdateUsuario 

        $("#btnUpdateUsuario").click(function(){
          event.preventDefault();
          var id = idUser
          var correo = $("#email").val().trim();
          var nombre = $("#nombre").val().trim();
          var contraseña = $("#password").val().trim();
          var estado = $("#estado").val().trim();
          var municipio = $("#municipio").val().trim();
          var cp = $("#codigoPostal").val().trim();
          var colonia = $("#colonia").val().trim();
          var calle = $("#calle").val().trim();
          var numeroInt = $("#numeroInt").val().trim();
          var numeroExt = $("#numeroExt").val().trim();
          var ref = $("#referencia").val().trim();
          var estatus = $("#idrole").val();
          var mensajeError = "Ingresa datos faltantes";
          var validado = true;

          var data = JSON.stringify({
            id:id,
            email: correo,
            name: nombre,
            password: contraseña,
            estado:estado,
            municipio:municipio,
            codigoPostal:cp,
            colonia:colonia,
            calle:calle,
            numeroInt:numeroInt,
            numeroExt:numeroExt,
            referencia:ref,
            estatus:estatus
          });


          // Verifica que los campos requeridos no estén vacíos o llenos de espacios
          if (correo == '' || !/(gmail|hotmail|outlook)\.com$/i.test(correo)) {
            validado = false;
            $("#email").css("border-color", "red");
            if (correo == '') {
              validado = false;
              $("#email").css("border-color", "red");
            } else {
              validado = false;
              mensajeError = '';
              mensajeError += 'Por favor ingrese una dirección de correo electrónico válida de Gmail, Hotmail u Outlook.'
            }
          }
          
          if (nombre == ''){
            validado = false;
            $("#nombre").css("border-color", "red");
          }
          if (contraseña == ''){
            validado = false;
            $("#password").css("border-color", "red");
          }
          if (estado == ''){
            validado = false;
            $("#estado").css("border-color", "red");
          }
          if (municipio == ''){
            validado = false;
            $("#municipio").css("border-color", "red");
          }
          if (cp == ''){
            validado = false;
          
            $("#codigoPostal").css("border-color", "red");
          }
          if (colonia == ''){
            validado = false;
            $("#colonia").css("border-color", "red");
          }
          if (calle == ''){
            validado = false;
            $("#calle").css("border-color", "red");
          }
          if (numeroExt == ''){
            validado = false;
          
            $("#numeroExt").css("border-color", "red");
          }
          if (ref == ''){
              validado = false;
              $("#referencia").css("border-color", "red");
          }
          $("#mensaje-error").text(mensajeError);
          if (validado == true){
            $.ajax({
              type: "POST",
              url: "/altaUsuarios/update_usuario",
              data: data,
              contentType: "application/json;charset=UTF-8",
              success: function (response) {
                console.log(response);
                // Manejar la respuesta del servidor
              if (response.status == 'success'){
                Swal.fire({
                  icon: "success",
                  title: "Edicion correcta!",
                  text: "Nuevo usuario registrado",
                  showConfirmButton: true,
                }).then((result) => {
                  if (result.isConfirmed) {
                    location.reload();
                  }
                  else {
                    location.reload();
                  }
                });
              }
              if (response.status == 'error'){
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "El correo ya está registrado, usa otro",
                });
              }
              },
              error: function (error) {
                // Manejar el error
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Algo salió mal!",
                });
              },
            });
          }

        });
        //-----------------------------------------Fin Alta de Usuarios-----------------------------------------


        //-----------------------------------------Inicio Finanzas-----------------------------------------


        //-----------------------------------------Fin Finanzas-----------------------------------------


        //fin docuemntready
      });
    </script>
  </body>
</html>
